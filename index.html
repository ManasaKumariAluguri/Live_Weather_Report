<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Live weather App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="searchBar">
      <div class="searchBarParentDiv">
        <input type="text" class="inputfield" placeholder="Search City">
        <i id="searchIcon" class="fa-solid fa-magnifying-glass" onclick="fetchData()"></i>
      </div>
    </div>
    <div class="mainContentParentDiv d-flex">
      <div class="leftDiv">
        <div class="currentTempDiv leftChild p-3 d-flex flex-column gap-2">
          <h6 class="m-0" id="cityName">City Name</h6>
          <h5 class="m-0"><span id="cityTemp">0</span>&deg;C</h5>
          <h6 id="skyDes">Sky Description</h6>
          <hr class="line">
          <div class="d-flex gap-2" >
            <i id="calender" class="fa fa-calendar-alt"></i>
            <h6 id="date">Date</h6>
          </div>
          <div class="d-flex gap-2">
            <i id="clock" class="fas fa-clock"></i>
            <h6 ><span id="time" >Time</span></h6>
          </div>
         </div>
        <div class="nextFiveDaysDiv leftChildtwo p-3 d-flex flex-column gap-2">
          <h6 class="m-0" id="comingFiveDays">Coming 5 Days</h6>
          <div class="d-flex flex-column gap-2">
          <div class="forecastRow d-flex align-items-center justify-content-between">
            <div class="d-flex gap-1 align-items-center justify-content-center">
              <img src="images/cloud.png" alt="" width="35px">
              <h5 class="m-0">0 &deg;C</h5>
          </div>
          <h6 class="m-0">-</h6>
          <h6 class="m-0">00-00-0000</h6>
          
        </div>
        <div class="forecastRow d-flex align-items-center justify-content-between">
            <div class="d-flex gap-1 align-items-center justify-content-center">
              <img src="images/cloud.png" alt="" width="35px">
              <h5 class="m-0">0 &deg;C</h5>
          </div>
          <h6 class="m-0">-</h6>
          <h6 class="m-0">00-00-0000</h6>
        </div>
        <div class="forecastRow d-flex align-items-center justify-content-between">
            <div class="d-flex gap-1 align-items-center justify-content-center">
              <img src="images/cloud.png" alt="" width="35px">
              <h6 class="m-0">0 &deg;C</h6>
          </div>
          <h6 class="m-0">-</h6>
          <h6 class="m-0">00-00-0000</h6>
        </div>
        <div class="forecastRow d-flex align-items-center justify-content-between">
            <div class="d-flex gap-1 align-items-center justify-content-center">
              <img src="images/cloud.png" alt="" width="35px">
              <h6 class="m-0">0 &deg;C</h6>
          </div>
          <h6 class="m-0">-</h6>
          <h6 class="m-0">00-00-0000</h6>
        </div>
        <div class="forecastRow d-flex align-items-center justify-content-between">
            <div class="d-flex gap-1 align-items-center justify-content-center">
              <img src="images/cloud.png" alt="" width="35px">
              <h5 class="m-0">0 &deg;C</h5>
          </div>
          <h6 class="m-0">-</h6>
          <h6 class="m-0">00-00-0000</h6>
        </div>
        <div class="forecastRow d-flex align-items-center justify-content-between">
            <div class="d-flex gap-1 align-items-center justify-content-center">
              <img src="images/cloud.png" alt="" width="35px">
              <h6 class="m-0">0 &deg;C</h6>
          </div>
          <h6 class="m-0">-</h6>
          <h6 class="m-0">00-00-0000</h6>
        </div>
      </div>
    </div>
    </div>
      <div class="rightDiv">
        <div class="rightRow rowOne d-flex gap-2 justify-content-between align-items-center">
          <div class="extraMetric d-flex gap-3">
            <img src="images/flood.png" alt="" width="35px">
            <div>
              <h5 class="m-0">Humidity</h5>
               <h6 id="humidityValue" class="m-0">--%</h6>
            </div>
          </div>
          <div class="extraMetric d-flex gap-3">
            <img src="images/wind (1).png" alt="" width="35px">
            <div>
              <h5 class="m-0">Pressure</h5>
              <h6 class="m-0" id="pressure">-</h6>
            </div>
          </div>
          <div class="extraMetric d-flex gap-3">
            <img src="images/hot.png" alt="" width="35px">
            <div>
              <h5 class="m-0">feels like</h5>
              <h6 class="m-0" id="feels_like">-</h6>
            </div>
          </div>
          <div class="extraMetric d-flex gap-3">
            <img src="images/eye.png" alt="" width="35px">
            <div>
              <h5 class="m-0">Visibilty</h5>
              <h6 class="m-0" id="visibility">-</h6>
            </div>
          </div>
        </div>
        <div class="rightRow rowTwo d-flex justify-content-between align-items-center">
          <div class="AQI rowTwoDiv p-3 d-flex flex-column gap-2">
            <h4 >Air Quality Index(AQI)</h4>
            <div class="d-flex justify-content-between align-items-center">
              <img src="images/wind.png" alt="" width="40px">
              <div class="text-center">
                <h5 class="m-0">SO2</h5>
                <h6 id="aqiSo2" class="m-0">-</h6>
              </div>
              <div class="text-center">
                <h5 class="m-0">NH3</h5>
                <h6 id="aqiNH3" class="m-0">-</h6>
              </div>
              <div class="text-center">
                <h5 class="m-0">NO2</h5>
                <h6 id="aqiNo2" class="m-0">-</h6>
              </div>
              <div class="text-center">
                <h5 class="m-0">O3</h5>
                <h6 id="aqiO3" class="m-0">-</h6>
              </div>
            </div>
          </div>
          <div class="sunRise rowTwoDiv p-3 ">
            <h5 >Sunrise & Sunset</h5>
           <div class="d-flex justify-content-between align-items-center"> 
            <div class="sunrise d-flex gap-2 align-items-center">
              <img src="images/sun.png" alt="" width="50px">
              <div class="sunrise d-flex flex-column gap-1 ">
                <h5 class="m-0">Sunrise</h5>
                  <h6 id="sunriseTime" class="m-0">00:00</h6>
              </div>
            </div>
            <div class="sunset d-flex gap-2 align-items-center">
              <img src="images/moon.png" alt="" width="40px">
              <div class="d-flex flex-column gap-1">
                <h5 class="m-0">Sunset</h5>
                  <h6 id="sunsetTime" class="m-0">00:00</h6>
              </div>
            </div>
           </div>
          </div>
        </div>
        <div class="rightRow rowThree d-flex flex-column gap-2">
          <h5 class="m-0">Today</h5>
          <div class="d-flex justify-content-between todayTempParentDiv">
            <div class="todayTemp">
            <h5 class="m-0">00:00</h5>
            <img src="images/clouds.png" alt=""width=35px>
            <h6 class="m-0">0&deg;C</h6>
          </div>
           <div class="todayTemp">
            <h5 class="m-0">00:00</h5>
            <img src="images/clouds.png" alt=""width=35px>
            <h6 class="m-0">0&deg;C</h6>
          </div>
           <div class="todayTemp">
            <h5 class="m-0">00:00</h5>
            <img src="images/clouds.png" alt=""width=35px>
            <h6 class="m-0">0&deg;C</h6>
          </div>
           <div class="todayTemp">
            <h5 class="m-0">00:00</h5>
            <img src="images/clouds.png" alt=""width=35px>
            <h6 class="m-0">0&deg;C</h6>
          </div>
           <div class="todayTemp">
            <h5 class="m-0">00:00</h5>
            <img src="images/clouds.png" alt=""width=35px>
            <h6 class="m-0">0&deg;C</h6>
          </div>
          <div class="todayTemp">
            <h5 class="m-0">00:00</h5>
            <img src="images/clouds.png" alt=""width=35px>
            <h6 class="m-0">0&deg;C</h6>
          </div>
          </div>
        </div>
      </div>
      </div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>  
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script>
  async function fetchData(){
    // single API call: 5-day / 3-hour forecast by city name
    function dateFormat(timestamp, tzOffsetSeconds){
      // timestamp is in seconds (UTC) and tzOffsetSeconds is seconds offset from UTC for the city
      if(!timestamp) return '';
      const offset = tzOffsetSeconds || 0;
      // create a Date for the city's local time by shifting the UTC timestamp
      const d = new Date((timestamp + offset) * 1000);
      // use UTC getters because we've already applied the offset
      const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const dayName = days[d.getUTCDay()];
      const monthName = months[d.getUTCMonth()];
      const date = d.getUTCDate();
      const year = d.getUTCFullYear();
      // time with AM/PM using UTC getters
      let hh = d.getUTCHours();
      const mm = d.getUTCMinutes();
      const ampm = hh >= 12 ? 'PM' : 'AM';
      hh = hh % 12;
      hh = hh ? hh : 12;
      const mins = mm < 10 ? '0'+mm : mm;
      return `${dayName}, ${monthName} ${date}, ${year}, ${hh}:${mins} ${ampm}`;
    }

    const cityNameInput = document.getElementsByClassName('inputfield')[0];
    const cityName = cityNameInput ? cityNameInput.value.trim() : '';
    if(!cityName) return alert('Please enter a city name');

    try{
      const apiKey = '87ec10cbf159cd24ccc88c7e21a61b0c';
      const url = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(cityName)}&appid=${apiKey}&units=metric`;
      const resp = await fetch(url);
      if(!resp.ok) throw new Error('City not found or API error');
      const data = await resp.json();
      console.log('forecast data', data);

      // Use the first available forecast entry as "current" approximation
      const first = data.list && data.list[0];
      const displayCity = data.city && data.city.name ? data.city.name : cityName;
      const currentTemp = first ? first.main.temp : '';
      const skyDescription = first ? first.weather[0].description : '';
      const humidity = first? first.main.humidity:'';
      // forecast response includes coords under data.city.coord
      const lat = data.city && data.city.coord && typeof data.city.coord.lat !== 'undefined' ? data.city.coord.lat : null;
      const lon = data.city && data.city.coord && typeof data.city.coord.lon !== 'undefined' ? data.city.coord.lon : null;
      if(lat !== null && lon !== null){
        console.log('Calling AQI fetch with', lat, lon);
        fetchAQIData(lat,lon);
      } else {
        console.warn('Coordinates missing; cannot fetch AQI');
      }
  // use system current UTC time (seconds) so displayed time is 'now' in the city's timezone
  const nowUtcSec = Math.floor(Date.now() / 1000);

      // update UI
      if(document.querySelector('#cityName')) document.querySelector('#cityName').innerText = displayCity;
      if(document.querySelector('#cityTemp')) document.querySelector('#cityTemp').innerText = currentTemp;
      if(document.querySelector('#skyDes')) document.querySelector('#skyDes').innerText = skyDescription;
      // update extra metrics (humidity, pressure, feels like, visibility) from the first forecast entry
      if(first && first.main){
        if(document.querySelector('#humidityValue') && typeof first.main.humidity !== 'undefined'){
          document.querySelector('#humidityValue').innerText = `${first.main.humidity}%`;
        }
        if(document.querySelector('#pressure') && typeof first.main.pressure !== 'undefined'){
          document.querySelector('#pressure').innerText = `${first.main.pressure} hPa`;
        }
        if(document.querySelector('#feels_like') && typeof first.main.feels_like !== 'undefined'){
          document.querySelector('#feels_like').innerText = `${Math.round(first.main.feels_like)} °C`;
        }
      }
      // visibility may be available on the forecast item (meters)
      if(document.querySelector('#visibility')){
        const vis = (first && typeof first.visibility !== 'undefined') ? first.visibility : (data.city && data.city.visibility ? data.city.visibility : undefined);
        if(typeof vis !== 'undefined'){
          // show in km if large
          document.querySelector('#visibility').innerText = (vis >= 1000) ? `${(vis/1000).toFixed(1)} km` : `${vis} m`;
        }
      }
      if(document.getElementById('#humidity')) document.getElementById('#humidity').innerText= humidity;
  const tzOffset = data.city && typeof data.city.timezone === 'number' ? data.city.timezone : 0;
  // compute city's current local time using system UTC now + city's tz offset
  const properdate = dateFormat(nowUtcSec, tzOffset);
      const lastComma = properdate.lastIndexOf(',');
      const datePart = lastComma !== -1 ? properdate.substring(0, lastComma).trim() : properdate;
      const timePart = lastComma !== -1 ? properdate.substring(lastComma + 1).trim() : '';
      if (document.querySelector('#date')) document.querySelector('#date').innerText = datePart;
      if (document.querySelector('#time')) document.querySelector('#time').innerText = timePart;

      // set sunrise/sunset times from city data if available
      if(data.city){
        const citySunrise = data.city.sunrise; // seconds UTC
        const citySunset = data.city.sunset; // seconds UTC
        if(typeof citySunrise !== 'undefined'){
          const sr = dateFormat(citySunrise, tzOffset).split(',').slice(-1)[0].trim();
          const el = document.getElementById('sunriseTime');
          if(el) el.innerText = sr;
        }
        if(typeof citySunset !== 'undefined'){
          const ss = dateFormat(citySunset, tzOffset).split(',').slice(-1)[0].trim();
          const el2 = document.getElementById('sunsetTime');
          if(el2) el2.innerText = ss;
        }
      }

      // --- Six phases over next 12 hours (2-hour spacing) ---
      try{
        const hourlyContainer = document.querySelector('.todayTempParentDiv');
        if(hourlyContainer && Array.isArray(data.list)){
          // compute city's local 'now' using tzOffset
          const localNow = new Date((nowUtcSec + tzOffset) * 1000);
          // use the current hour, ignore minutes (e.g., 03:30 -> 03:00)
          const startHour = localNow.getUTCHours();
          const localYear = localNow.getUTCFullYear();
          const localMonth = localNow.getUTCMonth(); // zero-based
          const localDate = localNow.getUTCDate();

          // build six target local datetimes spaced every 2 hours
          const targets = [];
          for(let i=0;i<6;i++){
            const h = startHour + i*2;
            // construct a Date in UTC that represents the city's local date/time
            // Date.UTC(...local parts with hour) gives the UTC ms for that local date/time;
            // subtract tzOffset*1000 to get the UTC ms that corresponds to that local time in the city's timezone
            const targetLocalMs = Date.UTC(localYear, localMonth, localDate, h, 0, 0);
            const targetUtcSec = Math.floor(targetLocalMs/1000) - tzOffset;
            targets.push({h24: (h % 24), utcSec: targetUtcSec});
          }

          // For each target, pick nearest forecast item by smallest time difference
          const slots = targets.map(t => {
            let nearest = null;
            let bestDiff = Infinity;
            data.list.forEach(item => {
              const diff = Math.abs(item.dt - t.utcSec);
              if(diff < bestDiff){ bestDiff = diff; nearest = item; }
            });
            return {target: t, nearest};
          });

          // render the six slots (clear existing)
          hourlyContainer.innerHTML = '';
          slots.forEach(s => {
            const {target, nearest} = s;
            // compute display time string (hour AM/PM, no minutes) for the city's local hour
            const displayHour = target.h24 % 24;
            let hh = displayHour % 12; hh = hh ? hh : 12;
            const ampm = displayHour >= 12 ? 'PM' : 'AM';
            const timeStr = `${hh} ${ampm}`;

            const tempVal = nearest && nearest.main ? Math.round(nearest.main.temp) : '-';
            // classify the condition and pick a local image to display beside the temperature
            const main = nearest && nearest.weather && nearest.weather[0] ? nearest.weather[0].main : '';
            const desc = nearest && nearest.weather && nearest.weather[0] ? nearest.weather[0].description : '';
            const category = classifyCondition((typeof tempVal === 'number') ? tempVal : (nearest && nearest.main ? nearest.main.temp : null), main, desc);
            const localImg = getConditionImage(category);

            const div = document.createElement('div');
            div.className = 'todayTemp d-flex flex-column align-items-center';
            const tEl = document.createElement('h5'); tEl.className = 'm-0'; tEl.innerText = timeStr;
            const img = document.createElement('img'); img.src = localImg; img.width = 35; img.alt = category;
            const tempEl = document.createElement('h5'); tempEl.className = 'm-0'; tempEl.innerText = (tempVal==='-') ? '-' : `${tempVal}°C`;
            div.appendChild(tEl); div.appendChild(img); div.appendChild(tempEl);
            hourlyContainer.appendChild(div);
          });
        }
      }catch(e){
        console.error('six-phase rendering error', e);
      }

      // aggregate per-day forecasts from the 3-hour list
      const daily = {};
      data.list.forEach(item => {
        // compute local date string for the city using tzOffset
        const localDate = new Date((item.dt + tzOffset) * 1000);
        const year = localDate.getUTCFullYear();
        const month = ('0'+(localDate.getUTCMonth()+1)).slice(-2);
        const day = ('0'+localDate.getUTCDate()).slice(-2);
        const dayStr = `${year}-${month}-${day}`; // YYYY-MM-DD in city's local time
        if(!daily[dayStr]){
          daily[dayStr] = {
            temps: [item.main.temp],
            icon: item.weather[0].icon,
            desc: item.weather[0].description,
            dt: item.dt
          };
        } else {
          daily[dayStr].temps.push(item.main.temp);
        }
      });
//COMING 5 DAYS AVG TEMPERATURE
  // build forecast rows for next 5 days (skip today) using city's local date
  const keys = Object.keys(daily);
  const todayLocal = new Date((nowUtcSec + tzOffset) * 1000);
  const todayStr = `${todayLocal.getUTCFullYear()}-${('0'+(todayLocal.getUTCMonth()+1)).slice(-2)}-${('0'+todayLocal.getUTCDate()).slice(-2)}`;
      const nextDays = keys.filter(k => k !== todayStr).slice(0,5);
      const container = document.querySelector('.nextFiveDaysDiv .d-flex.flex-column');
      if(container){
        container.innerHTML = '';
        nextDays.forEach(k => {
          const info = daily[k];
          const avgTemp = Math.round(info.temps.reduce((a,b)=>a+b,0)/info.temps.length);
          const row = document.createElement('div');
          row.className = 'forecastRow d-flex align-items-center justify-content-between';

          const left = document.createElement('div');
          left.className = 'd-flex gap-1 align-items-center justify-content-center';
          const img = document.createElement('img');
          img.src = `http://openweathermap.org/img/wn/${info.icon}@2x.png`;
          img.alt = info.desc || '';
          img.width = 35;
          const t = document.createElement('h5'); t.className='m-0'; t.innerText = `${avgTemp} °C`;
          left.appendChild(img); left.appendChild(t);

          const dayNameEl = document.createElement('h5'); dayNameEl.className='m-0';
          // parse k (YYYY-MM-DD) and create UTC-based date representing city's local midnight
          const parts = k.split('-');
          const localDt = new Date(Date.UTC(parts[0], parseInt(parts[1],10)-1, parts[2]));
          // compute weekday and date using UTC getters (localDt represents city's local date at UTC)
          const daysArr = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
          dayNameEl.innerText = daysArr[localDt.getUTCDay()];

          const dateEl = document.createElement('h5'); dateEl.className='m-0';
          dateEl.innerText = `${('0'+(localDt.getUTCMonth()+1)).slice(-2)}-${('0'+localDt.getUTCDate()).slice(-2)}-${localDt.getUTCFullYear()}`;

          row.appendChild(left); row.appendChild(dayNameEl); row.appendChild(dateEl);
          container.appendChild(row);
        });
      }

    }catch(err){
      console.error(err);
      alert('Failed to fetch weather. Check the city name or API key.');
    }
  }

  // --- inlined script.js content (forecast renderer) ---
  const OPENWEATHER_KEY = '87ec10cbf159cd24ccc88c7e21a61b0c';

  // classify a weather slot into a small set of categories for rowThree images
  // temp: number in °C (can be null), main: weather[0].main string, desc: weather[0].description
  function classifyCondition(temp, main, desc){
    const m = (main || '').toLowerCase();
    const d = (desc || '').toLowerCase();
    // precipitation / storm
    if(m.includes('rain') || m.includes('drizzle') || m.includes('thunder')) return 'rainy';
    if(m.includes('snow')) return 'snowy';
    // fog / mist / haze
    if(m.includes('mist') || m.includes('fog') || m.includes('haze') || d.includes('fog') || d.includes('mist')) return 'foggy';
    // clouds
    if(m.includes('cloud')) return 'cloudy';
    // temperature-based: consider too hot or cool
    if(typeof temp === 'number'){
      if(temp >= 30) return 'too-hot';
      if(temp <= 15) return 'cool';
    }
    // default to clear/mild
    return 'clear';
  }

  // map our small category names to local image filenames (adjust if your project uses different names)
  function getConditionImage(category){
    switch(category){
      case 'rainy': return 'images/flood.png';
      case 'snowy': return 'images/cloud.png';
      case 'foggy': return 'images/cloud.png';
      case 'cloudy': return 'images/clouds.png';
      case 'too-hot': return 'images/hot.png';
      case 'cool': return 'images/wind (1).png';
      case 'clear': return 'images/sun.png';
      default: return 'images/clouds.png';
    }
  }

  // format date from unix seconds to Weekday and date
  function formatDay(dtSeconds){
    const d = new Date(dtSeconds * 1000);
    const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    return days[d.getDay()];
  }

  // render next 5 days into the nextFiveDaysDiv (not used by main flow but kept available)
  async function nextFiveDays(lat, lon){
    try{
      // Use One Call API (daily) to get daily forecast
      const url = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=current,minutely,hourly,alerts&units=metric&appid=${OPENWEATHER_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      if(!data || !data.daily) return;
      const container = document.querySelector('.nextFiveDaysDiv .d-flex.flex-column');
      if(!container) return;
      container.innerHTML = ''; // clear existing
      // take next 5 days (skip today — start from index 1)
      const days = data.daily.slice(1,6);
      days.forEach(day => {
        const row = document.createElement('div');
        row.className = 'forecastRow d-flex align-items-center justify-content-between';

        const left = document.createElement('div');
        left.className = 'd-flex gap-1 align-items-center justify-content-center';
        const img = document.createElement('img');
        img.src = `http://openweathermap.org/img/wn/${day.weather[0].icon}@2x.png`;
        img.alt = day.weather[0].description || 'weather';
        img.width = 35;
        const temp = document.createElement('h5');
        temp.className = 'm-0';
        temp.innerText = `${Math.round(day.temp.day)} °C`;
        left.appendChild(img);
        left.appendChild(temp);

        const weekday = document.createElement('h5');
        weekday.className = 'm-0';
        weekday.innerText = formatDay(day.dt);

        const date = document.createElement('h5');
        date.className = 'm-0';
        const d = new Date(day.dt * 1000);
        date.innerText = `${('0'+(d.getMonth()+1)).slice(-2)}-${('0'+d.getDate()).slice(-2)}-${d.getFullYear()}`;

        row.appendChild(left);
        row.appendChild(weekday);
        row.appendChild(date);
        container.appendChild(row);
      });
    }catch(err){
      console.error('nextFiveDays error', err);
    }
  }

  // Expose nextFiveDays globally
  window.nextFiveDays = nextFiveDays;
//AQI ROWTWO
async function fetchAQIData(lat, lon){
  try{
    const apiKey = '87ec10cbf159cd24ccc88c7e21a61b0c';
    const res = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`);
    if(!res.ok) throw new Error('AQI fetch failed');
    const data = await res.json();
    // data.list[0].main.aqi (1-5), components contains pollutant concentrations
    if(data && data.list && data.list.length){
      const item = data.list[0];
      const aqi = item.main && typeof item.main.aqi !== 'undefined' ? item.main.aqi : '-';
      const comps = item.components || {};
      // update UI
      if(document.getElementById('aqiSo2')) document.getElementById('aqiSo2').innerText =  (typeof comps.so2 !== 'undefined')? `${comps.so2} µg/m³` : '-';
      if(document.getElementById('aqiNH3')) document.getElementById('aqiNH3').innerText = (typeof comps.nh3 !== 'undefined')? `${comps.nh3} µg/m³` : '-';
      if(document.getElementById('aqiNo2')) document.getElementById('aqiNo2').innerText = (typeof comps.no2 !== 'undefined')? `${comps.no2} µg/m³` : '-';
      if(document.getElementById('aqiO3')) document.getElementById('aqiO3').innerText = (typeof comps.o3 !== 'undefined')? `${comps.o3} µg/m³` : '-';
    }
  }catch(err){
    console.error('fetchAQIData error', err);
  }
}
</script>
</body>
</html>
